# Experimenting with CSP
## Basic CSP - script-src
Headers:
```
Content-Type: text/html
Content-Security-Policy: script-src 'self'
```

HTML Body:
```
<script>alert("Some inline script. Possibly XSS.")</script>
```

Result: script blocked ('self' doesn't permit inline scripts)

## CSP with 'unsafe-inline'
Headers:
```
Content-Type: text/html
Content-Security-Policy: script-src 'self' 'unsafe-inline'
```

HTML Body:
```
<script>alert("Some inline script. Possibly XSS.")</script>
```

Result: inline script executes

## CSP with inline script allowed by hash
Headers:
```
Content-Type: text/html
Content-Security-Policy:  script-src 'self' 'sha256-6ZK6Eqp7qaAL9wUcEKuTHEEqS7g+TsVxR626DuBJHVI='
```

HTML Body:
```
<script>alert("whitelisted by hash");</script>	
```

- hash value is only claculated over the content of the `<script>` tag
- hash can easily be generated with `openssl`:
  ```
  echo -n 'alert("whitelisted by hash");' | openssl sha256 -binary | openssl base64
  ```
  
## CSP with inline script allowed by nonce
Headers:
```
Content-Type: text/html
Content-Security-Policy: script-src 'self' 'nonce-mySecureNonce' 
```

HTML Body:
```
<script nonce="mySecureNonce">alert("whitelisted by nonce");</script>
```


- nonce should be randomly generated by server each time it serves a page


# CSP in HTML meta tag
Headers:
```
Content-Type: text/html
```

HTML Head:
```
<meta http-equiv="Content-Security-Policy" content="script-src 'self'" />
```

HTML Body:
```
<script>alert("script should be blocked");</script>
```

# CSP in HTML meta-tag only affects elements after it
Headers:
```
Content-Type: text/html
```

HTML Head:
```
<script>alert("before CSP meta-tag");</script>
<meta http-equiv="Content-Security-Policy" content="script-src 'self'" />
<script>alert("after CSP meta-tag");</script>
```

- CSPs in meta-tags only take effect after the tag
- therefore CSP via header is preferred


# Multiple CSPs
Headers:
```
Content-Type: text/html
Content-Security-Policy: default-src 'none'
Content-Security-Policy: script-src 'self' 'nonce-8qTDE2ga1lrwYsOwPl2uOltr5S1uMW'
```

HTML Body:
```
<script nonce="8qTDE2ga1lrwYsOwPl2uOltr5S1uMW">alert("does this execute?")</script>
```

- all CSPs are applied individually, if an element violates at least one, it is blocked
- therefore additional CSPs can only impose further restrictions, never make it more permissive

